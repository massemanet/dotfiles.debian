#!/usr/bin/env bash

_usage() {
    $0 upload | download | maxmind
    exit 0
}

_err() {
    echo "${1:-}"
    exit 7
}

_chk() {
    [ -z "${2:-}" ] && _err "please provide $1"
    echo "$2"
}

_upload() {
    read -r -p "host: " HOST
    scp -r "$PET" "$HOST:"
}

_download() {
    read -r -p "host: " HOST
    mkdir -p "$PET"
    scp -r "$HOST:$PET" "$HOME"
}

_maxmind() {
    local KEYNAME="$1"
    eval "export $KEYNAME=$(cat "$PET/maxmind/key")"
}

PET=$HOME/pet

case "${1:-}" in
    upload)   _upload;;
    download) _download;;
    maxmind)  _chk "keyname" "$2" && _maxmind "$2";;
    "")       _usage;;
    *)        _err "unrecognized command: $1";;
esac
